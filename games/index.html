<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Games • 420360</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
	:root{
		--bg:#2d1b2d;--primary:#9370db;--secondary:#ba55d3;--highlight:#dda0dd;--text:#f8f8ff;
	}
	html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:'Press Start 2P','Courier New',monospace;image-rendering:pixelated;}
	body{padding:20px 10px 60px 10px;}
	h1{font-size:18px;letter-spacing:2px;text-align:center;margin:0 0 28px 0;color:var(--highlight);text-shadow:2px 2px 0 var(--primary),4px 4px 0 #000;}
	.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:28px;max-width:1200px;margin:0 auto;}
	.card{position:relative;background:var(--bg);border:4px solid var(--secondary);box-shadow:0 0 0 4px var(--primary),6px 6px 0 0 var(--highlight),0 0 0 8px #000;padding:10px 8px 14px 8px;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;min-height:220px;transition:transform .18s, filter .18s;cursor:pointer;text-align:center;}
	.card:hover{transform:translate(-3px,-3px);filter:brightness(1.2) contrast(1.1);}  
	.card:active{transform:translate(1px,1px);} 
	.card h2{font-size:10px;line-height:1.4;margin:4px 0 8px 0;color:var(--highlight);text-shadow:2px 2px 0 var(--primary);} 
	.card small{display:block;font-size:8px;opacity:.85;line-height:1.5;color:var(--secondary);} 
	a.card-link{color:inherit;text-decoration:none;display:contents;} /* allow full card click */
	.tagrow{display:flex;flex-wrap:wrap;gap:4px;justify-content:center;margin-top:auto;}
	.tag{font-size:7px;padding:2px 4px;background:var(--primary);color:#000;letter-spacing:1px;}
	.card img.preview{width:100%;height:100px;object-fit:cover;image-rendering:pixelated;border:3px solid var(--primary);box-shadow:0 0 0 3px var(--secondary),4px 4px 0 0 var(--highlight);background:#000;margin:0 0 6px 0;}
	.score-display{font-size:8px;color:var(--highlight);text-shadow:1px 1px 0 var(--primary);margin:4px 0 2px 0;min-height:12px;}
	.ascii{font-family:monospace;font-size:8px;line-height:10px;white-space:pre;text-align:center;color:var(--primary);text-shadow:0 0 4px var(--secondary);} 
	.banner{max-width:260px;margin:0 auto 20px auto;display:block;border:4px solid var(--primary);box-shadow:0 0 0 4px var(--secondary),6px 6px 0 0 var(--highlight),0 0 0 8px #000;}
	.filters{max-width:1200px;margin:0 auto 18px auto;display:flex;flex-wrap:wrap;gap:10px;justify-content:center;}
	.filters button{font-family:'Press Start 2P',monospace;font-size:9px;padding:6px 10px;background:var(--bg);color:var(--highlight);border:3px solid var(--secondary);box-shadow:0 0 0 3px var(--primary),4px 4px 0 0 var(--highlight),0 0 0 6px #000;cursor:pointer;}
	.filters button.active,.filters button:hover{background:var(--secondary);color:#000;}
	footer{margin-top:40px;text-align:center;font-size:8px;letter-spacing:1px;color:var(--highlight);opacity:.75;}
	.searchWrap{display:flex;justify-content:center;margin:0 0 24px 0;}
	.searchWrap input{background:#000;color:var(--highlight);border:3px solid var(--secondary);box-shadow:0 0 0 3px var(--primary),4px 4px 0 0 var(--highlight),0 0 0 6px #000;padding:8px 10px;font-family:'Press Start 2P',monospace;font-size:10px;width:260px;}
	.empty{margin:40px 0;text-align:center;font-size:12px;color:var(--secondary);} 
	@media (max-width:600px){ .grid{gap:18px;} h1{font-size:14px;} .card{min-height:150px;} }
</style>
</head>
<body>
	<h1>ARCADE DIRECTORY</h1>
	<div class="searchWrap"><input type="text" id="gameSearch" placeholder="TYPE TO FILTER" aria-label="Filter games" /></div>
	<div class="filters" aria-label="Tag filters">
		<button data-tag="all" class="active">ALL</button>
		<button data-tag="puzzle">PUZZLE</button>
		<button data-tag="arcade">ARCADE</button>
		<button data-tag="memory">MEMORY</button>
		<button data-tag="retro">RETRO</button>
		<button data-tag="experimental">EXPERIMENTAL</button>
	</div>
	<div class="grid" id="gamesGrid" aria-live="polite"></div>
	<div class="empty" id="emptyMsg" style="display:none;">NO MATCHES</div>
	<footer>Press G again to close • ESC also works</footer>
<script>
// Data for games (manually curated tags & blurbs)
// NOTE: All GIF previews must come from the woodmurderedhat Giphy channel (curated IDs reused as needed)
// Available IDs reference: 3PLAXg1osLVVttjRTN, WveGOgFwcI6uTn2khE, eYDnuFt0MckAb3xdSH, DfqSbJVYLHmO8QFn1R,
// 7Ti0iZdo5QCiWJfMvA, qxJ9pAQCBIJLxfelCv, HtCcDJ134eAICJZjLb, JeEjGpM2TVZGaM5BuE
const GAMES = [
	{ id:'tarot-tetromino', name:'TAROT TETROMINO', url:'tarot-tetromino/', tags:['puzzle','experimental','retro'], blurb:'Arcana-fused falling blocks.', gif:'https://media.giphy.com/media/3PLAXg1osLVVttjRTN/giphy.gif', scoreKey:'tetrisLeaderboard', scoreType:'leaderboard' },
	{ id:'glitch-maze', name:'GLITCH MAZE', url:'glitch-maze/', tags:['puzzle','experimental'], blurb:'Escape distortion.', gif:'https://media.giphy.com/media/7Ti0iZdo5QCiWJfMvA/giphy.gif', scoreKey:'glitchMazeBestLevel', scoreType:'level' },
	{ id:'neon-simon', name:'NEON SIMON', url:'neon-simon/', tags:['memory','retro'], blurb:'Sequence recall glow.', gif:'https://media.giphy.com/media/WveGOgFwcI6uTn2khE/giphy.gif', scoreKey:'neonSimonBest', scoreType:'score' },
	{ id:'pixel-rain', name:'PIXEL RAIN', url:'pixel-rain/', tags:['experimental','retro'], blurb:'Falling pixel ambience.', gif:'https://media.giphy.com/media/qxJ9pAQCBIJLxfelCv/giphy.gif', scoreKey:'pixelRainBest', scoreType:'score' },
	{ id:'pong', name:'PONG CLASSIC', url:'pong/', tags:['arcade','retro'], blurb:'OG duel of reflex.', gif:'https://media.giphy.com/media/HtCcDJ134eAICJZjLb/giphy.gif', scoreKey:'pongBestWins', scoreType:'wins' },
	{ id:'snake', name:'SNAKE', url:'snake/', tags:['arcade','retro'], blurb:'Devour & grow.', gif:'https://media.giphy.com/media/JeEjGpM2TVZGaM5BuE/giphy.gif', scoreKey:'snakeHighScore', scoreType:'score' },
	{ id:'memory', name:'MEMORY CARDS', url:'memory/', tags:['memory','puzzle'], blurb:'Flip & match pairs.', gif:'https://media.giphy.com/media/DfqSbJVYLHmO8QFn1R/giphy.gif', scoreKey:'memoryBestScore', scoreType:'score' },
	{ id:'breakout', name:'BREAKOUT', url:'breakout/', tags:['arcade','retro'], blurb:'Brick smashing zen.', gif:'https://media.giphy.com/media/eYDnuFt0MckAb3xdSH/giphy.gif', scoreKey:'breakoutHighScore', scoreType:'score' },
	{ id:'flappy-bird', name:'FLAPPY BIRD', url:'flappy-bird/', tags:['arcade','retro'], blurb:'Navigate through pipes.', gif:'https://media.giphy.com/media/JeEjGpM2TVZGaM5BuE/giphy.gif', scoreKey:'flappyBirdHighScore', scoreType:'score' },
	{ id:'space-invaders', name:'SPACE INVADERS', url:'space-invaders/', tags:['arcade','retro'], blurb:'Defend against aliens.', gif:'https://media.giphy.com/media/HtCcDJ134eAICJZjLb/giphy.gif', scoreKey:'spaceInvadersHighScore', scoreType:'score' },
	{ id:'asteroids', name:'ASTEROIDS', url:'asteroids/', tags:['arcade','retro'], blurb:'Navigate & destroy rocks.', gif:'https://media.giphy.com/media/qxJ9pAQCBIJLxfelCv/giphy.gif', scoreKey:'asteroidsHighScore', scoreType:'score' },
	{ id:'infinite-jumper', name:'INFINITE JUMPER', url:'infinite-jumper/', tags:['arcade','retro'], blurb:'Jump to infinite heights.', gif:'https://media.giphy.com/media/eYDnuFt0MckAb3xdSH/giphy.gif', scoreKey:'infiniteJumperHighScore', scoreType:'score' },
	{ id:'generative-art', name:'GENERATIVE ART', url:'generative-art/', tags:['experimental'], blurb:'Procedural visuals.', gif:'https://media.giphy.com/media/3PLAXg1osLVVttjRTN/giphy.gif' },
	{ id:'tim-the-dialogue-oracle', name:'TIM • ORACLE', url:'../tim-the-dialogue-oracle/', tags:['experimental'], blurb:'Conversational mystic.', gif:'https://media.giphy.com/media/7Ti0iZdo5QCiWJfMvA/giphy.gif' },
	{ id:'noctis-reverie', name:'NOCTIS REVERIE', url:'noctis-reverie/', tags:['experimental'], blurb:'Dreamlike voyage.', gif:'https://media.giphy.com/media/WveGOgFwcI6uTn2khE/giphy.gif' },
	{ id:'pixel-crush', name:'PIXEL CRUSH', url:'pixel-crush/', tags:['puzzle','experimental'], blurb:'Match-3 pixel mayhem.', gif:'https://media.giphy.com/media/3PLAXg1osLVVttjRTN/giphy.gif', scoreKey:'pixelCrushProgress', scoreType:'total' }
];

const grid = document.getElementById('gamesGrid');
const emptyMsg = document.getElementById('emptyMsg');
const searchInput = document.getElementById('gameSearch');
const filterBtns = Array.from(document.querySelectorAll('.filters button'));
let activeTag = 'all';

function getGameScore(game) {
	if (!game.scoreKey) return null;
	
	try {
		const stored = localStorage.getItem(game.scoreKey);
		if (!stored) return null;
		
		switch (game.scoreType) {
			case 'leaderboard':
				const scores = JSON.parse(stored);
				return scores.length > 0 ? scores[0].score : null;
			case 'total':
				const progress = JSON.parse(stored);
				return progress.bestScores ? progress.bestScores.total : null;
			case 'score':
			case 'level':
			case 'wins':
				return parseInt(stored) || null;
			default:
				return null;
		}
	} catch (e) {
		return null;
	}
}

function formatScore(score, type) {
	if (score === null) return 'No scores yet';
	
	switch (type) {
		case 'level':
			return `Level ${score}`;
		case 'wins':
			return `${score} wins`;
		case 'score':
		default:
			return score.toString();
	}
}

function render(){
	grid.innerHTML='';
	const term = searchInput.value.trim().toLowerCase();
	const filtered = GAMES.filter(g => {
		const tagOk = activeTag==='all' || g.tags.includes(activeTag);
		const termOk = !term || g.name.toLowerCase().includes(term) || g.blurb.toLowerCase().includes(term);
		return tagOk && termOk;
	});
	if(!filtered.length){ emptyMsg.style.display='block'; return; } else emptyMsg.style.display='none';
	filtered.forEach(g => {
		const card = document.createElement('div');
		card.className='card';
		
		const score = getGameScore(g);
		const scoreDisplay = g.scoreKey ? `<div class="score-display">Best: ${formatScore(score, g.scoreType)}</div>` : '';
		
		card.innerHTML = `<img class='preview' src='${g.gif}' alt='Preview for ${g.name}' loading='lazy'><h2>${g.name}</h2><small>${g.blurb}</small>${scoreDisplay}<div class="tagrow">${g.tags.map(t=>`<span class='tag'>${t.toUpperCase()}</span>`).join('')}</div>`;
		card.addEventListener('click', ()=>{
			const targetUrl = 'games/' + g.url + 'index.html';
			// Prefer postMessage for decoupled communication
			try{
				if(window.parent){
					window.parent.postMessage({type:'open-game', label:g.name, url:targetUrl}, '*');
					// Also request parent to close the games index overlay so only game is visible
					window.parent.postMessage({type:'close-overlay', id:'gamesIndexOverlay'}, '*');
					return;
				}
			}catch(err){ /* ignore and fallback */ }
			// Fallback direct method if available
			if(window.parent && window.parent.openGameOverlay){
				window.parent.openGameOverlay(g.name + ' • 420360', targetUrl);
				return;
			}
			// Last resort open in new tab
			window.open(g.url,'_blank');
		});
		card.addEventListener('keydown', e=>{ if(e.key==='Enter'){ card.click(); }});
		card.tabIndex=0;
		grid.appendChild(card);
	});
}
filterBtns.forEach(btn=>{
	btn.addEventListener('click', ()=>{
		filterBtns.forEach(b=>b.classList.remove('active'));
		btn.classList.add('active');
		activeTag = btn.dataset.tag;
		render();
	});
});
searchInput.addEventListener('input', render);
render();
// Keyboard: ESC closes overlay (delegated to parent) by simulating escape there
window.addEventListener('keydown', e=>{ if(e.key==='Escape'){ try{ window.parent.document.dispatchEvent(new KeyboardEvent('keydown',{key:'Escape'})); }catch(err){} }});
</script>
</body>
</html>
