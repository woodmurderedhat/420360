<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarot Tetris Sound Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        h1, h2 {
            color: #333;
        }
        .control-panel {
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .sound-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .music-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .current-track {
            margin-top: 10px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>Tarot Tetris Sound Test</h1>

    <div class="control-panel">
        <h2>Music Controls</h2>
        <div class="music-controls">
            <button id="play-music">Play Music</button>
            <button id="stop-music">Stop Music</button>
            <button id="prev-track">Previous Track</button>
            <button id="next-track">Next Track</button>
        </div>
        <div class="current-track" id="current-track-info">No track playing</div>
        <div id="sound-settings-container"></div>
    </div>

    <div class="control-panel">
        <h2>Sound Effects</h2>
        <div class="sound-grid" id="sound-buttons">
            <!-- Sound buttons will be added here dynamically -->
        </div>
    </div>

    <!-- Scripts -->
    <script src="src/eventSystem.js"></script>
    <script src="src/soundSystem.js"></script>

    <script>
        // Initialize the event system
        if (!window.TarotTetris) {
            window.TarotTetris = {};
        }

        // Define events if they don't exist
        if (!window.TarotTetris.EVENTS) {
            window.TarotTetris.EVENTS = {
                GAME_INITIALIZED: 'game:initialized',
                GAME_STARTED: 'game:started',
                GAME_PAUSED: 'game:paused',
                GAME_RESUMED: 'game:resumed',
                GAME_OVER: 'game:over',
                LEVEL_UP: 'game:levelUp',
                PIECE_SPAWNED: 'piece:spawned',
                PIECE_MOVED: 'piece:moved',
                PIECE_ROTATED: 'piece:rotated',
                PIECE_LOCKED: 'piece:locked',
                PIECE_HELD: 'piece:held',
                PIECE_DROPPED: 'piece:dropped',
                LINES_CLEARED: 'board:linesCleared',
                BOARD_CLEARED: 'board:cleared',
                SCORE_UPDATED: 'score:updated',
                GOLD_UPDATED: 'gold:updated',
                TAROT_CARD_ADDED: 'tarot:cardAdded',
                TAROT_CARD_PLAYED: 'tarot:cardPlayed',
                UI_OVERLAY_SHOWN: 'ui:overlayShown',
                UI_OVERLAY_HIDDEN: 'ui:overlayHidden',
                SHOP_OPENED: 'shop:opened',
                SHOP_CLOSED: 'shop:closed',
                TETRIMINO_UPGRADED: 'shop:tetriminoUpgraded',
                TETRIMINO_UNLOCKED: 'shop:tetriminoUnlocked',
                ITEM_PURCHASED: 'shop:itemPurchased'
            };
        }

        // Initialize the sound system
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize sound system
            if (TarotTetris.sound && typeof TarotTetris.sound.initialize === 'function') {
                TarotTetris.sound.initialize();

                // Emit the game initialized event
                if (TarotTetris.events && typeof TarotTetris.events.emit === 'function') {
                    TarotTetris.events.emit(TarotTetris.EVENTS.GAME_INITIALIZED);
                }

                // Create sound settings UI
                const soundSettingsContainer = document.getElementById('sound-settings-container');
                if (soundSettingsContainer && typeof TarotTetris.sound.createSoundSettingsUI === 'function') {
                    soundSettingsContainer.appendChild(TarotTetris.sound.createSoundSettingsUI());
                }

                // Create sound effect buttons
                createSoundButtons();

                // Set up music control buttons
                setupMusicControls();

                // Update track info
                updateTrackInfo();
            }
        });

        // Create buttons for all sound effects
        function createSoundButtons() {
            const soundButtonsContainer = document.getElementById('sound-buttons');
            if (!soundButtonsContainer || !TarotTetris.sound.SOUND_EFFECTS) return;

            // Clear existing buttons
            soundButtonsContainer.innerHTML = '';

            // Create a button for each sound effect
            for (const [effectKey, effectId] of Object.entries(TarotTetris.sound.SOUND_EFFECTS)) {
                const button = document.createElement('button');
                button.textContent = effectKey.replace(/_/g, ' ');
                button.addEventListener('click', () => {
                    TarotTetris.sound.playSound(effectId);
                });
                soundButtonsContainer.appendChild(button);
            }
        }

        // Set up music control buttons
        function setupMusicControls() {
            const playMusicBtn = document.getElementById('play-music');
            const stopMusicBtn = document.getElementById('stop-music');
            const prevTrackBtn = document.getElementById('prev-track');
            const nextTrackBtn = document.getElementById('next-track');

            if (playMusicBtn) {
                playMusicBtn.addEventListener('click', () => {
                    TarotTetris.sound.startMusicPlaylist();
                    updateTrackInfo();
                });
            }

            if (stopMusicBtn) {
                stopMusicBtn.addEventListener('click', () => {
                    TarotTetris.sound.stopMusic();
                    updateTrackInfo();
                });
            }

            if (prevTrackBtn) {
                prevTrackBtn.addEventListener('click', () => {
                    TarotTetris.sound.playPreviousTrack();
                    updateTrackInfo();
                });
            }

            if (nextTrackBtn) {
                nextTrackBtn.addEventListener('click', () => {
                    TarotTetris.sound.playNextTrack();
                    updateTrackInfo();
                });
            }
        }

        // Update the current track information
        function updateTrackInfo() {
            const trackInfoElement = document.getElementById('current-track-info');
            if (!trackInfoElement || !TarotTetris.sound.getCurrentTrackInfo) return;

            const trackInfo = TarotTetris.sound.getCurrentTrackInfo();
            if (trackInfo.path) {
                const filename = trackInfo.path.split('/').pop();
                const directory = trackInfo.path.split('/')[1]; // Get 'music' or 'sounds'
                trackInfoElement.textContent = `Playing: ${filename} (${trackInfo.index + 1}/${trackInfo.total}) from ${directory} folder`;

                // Check if the audio is actually playing
                const audioElement = document.querySelector('audio');
                if (audioElement && audioElement.paused) {
                    trackInfoElement.textContent += ' [PAUSED]';
                }
            } else {
                trackInfoElement.textContent = 'No track playing';
            }

            // Set a timer to update the track info periodically
            setTimeout(updateTrackInfo, 1000);
        }
    </script>
</body>
</html>
